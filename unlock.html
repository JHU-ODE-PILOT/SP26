---
layout: default
title: "Unlock Website"
pageCate: "PSets"
---

<div style="text-align: center;">
    <h2>Unlock the Website</h2>
    <br>
    <p> Enter the unlock password to unlock all problem sets.</p>
    <br>
    <input type="password" id="passwordInput" placeholder="Enter password"> <br><br>
    <button onclick="fetchPasswords()">Get Passwords</button>
    <br><br>
    If you happen to be an educator, feel free to <a href="/SP26/contacts.html">contact</a> us to unlock all these documents.
</div>


<script>
    async function fetchPasswords() {
        return;
        const password = document.getElementById('passwordInput').value;
        
        // Check if password is empty
        if (!password) {
            alert("Please enter a password");
            return;
        }
        
        try {
            console.log("Sending request...");
            
            const response = await fetch('https://script.google.com/macros/s/AKfycbw67oRQBcHgWWv5Q4m1ZQKT-6OdsmXDr96TAUyfKxakwloV5jxvx7XHQhI6rzy7mw_zcg/exec', {
                method: 'POST',
                redirect: 'follow',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify({ password: password })
            });

            console.log("Response status:", response.status);
            console.log("Response headers:", response.headers);

            // Check if response is ok
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            // Get the response text
            const rawText = await response.text();
            console.log("RAW RESPONSE: ", rawText);
            console.log("Response length: ", rawText.length);

            // Check if response is empty
            if (!rawText || rawText.trim() === '') {
                throw new Error("Empty response from server");
            }

            // Parse the JSON
            let data;
            try {
                data = JSON.parse(rawText);
            } catch (e) {
                console.error("JSON Parse Error:", e);
                alert("Server response was NOT valid JSON!\nResponse: " + rawText);
                return;
            }

            console.log("Parsed data:", data);

            // Check if successful
            if (data.status !== "success") {
                alert(data.message || "Unsuccessful unlock.");
                return;
            }
            
            // File mapping
            const fileMap = {
                p1: "PS1-Soln.pdf",
                p2: "PS2-Soln.pdf",
                p4: "PS4-Soln.pdf",
                p5: "PS5-Soln.pdf",
                p7: "PS7-Soln.pdf",
                p8: "PS8-Soln.pdf",
                p10: "PS10-Soln.pdf",
                p11: "PS11-Soln.pdf",
                p13: "PS13-Soln.pdf"
            };

            // Store passwords in localStorage
            const ps = data.passwords;
            let storedCount = 0;
            for (const pKey in ps) {
                if (fileMap[pKey]) {
                    const storageKey = `pwd-/FA26/psets/${fileMap[pKey]}`;
                    localStorage.setItem(storageKey, ps[pKey]);
                    console.log(`Stored ${storageKey}: ${ps[pKey]}`);
                    storedCount++;
                }
            }
            
            alert(`Passwords unlocked! Saved ${storedCount} passwords.`);

        } catch (error) {
            console.error("Fetch error:", error);
            alert("Error: " + error.message);
        }
    }
</script>